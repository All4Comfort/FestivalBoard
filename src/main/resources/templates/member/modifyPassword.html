<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>축제 게시판</title>
    
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    
    
    
    
        <style>
            /* 드롭다운 메뉴에서 화살표를 숨깁니다. */
            .dropdown-toggle::after {
                display: none;
            }
    
            /* 드롭다운 메뉴의 위치를 조절합니다. */
            .dropdown-menu {
                left: 0;
                /* 드롭다운 메뉴가 화면 왼쪽에 정렬되도록 설정합니다. */
                margin-left: -30px;
                /* 원하는 만큼 왼쪽으로 이동시킵니다. */
            }
    
            /* 메뉴 항목 사이에 오른쪽 마진(간격)을 추가합니다. */
            .nav-item:not(:last-child) {
                margin-right: 50px;
                /* 원하는 간격 크기(픽셀)를 지정합니다. */
            }
    
            /* 검색 입력 상자 스타일 */
            .search-box {
                margin-top: 20px;
                text-align: center;
            }
    
            .search-button {
                background-color: black;
                color: #fff;
                border: none;
                border-radius: 4px;
                padding: 10px 20px;
                margin-left: 5px;
                cursor: pointer;
            }
    
            /* 검색 입력 상자 크기 조절 */
            #search-input {
                width: 600px;
                /* 원하는 폭으로 조절 (예: 300px) */
                padding: 10px;
                /* 내부 여백 추가 */
                font-size: 16px;
                /* 글꼴 크기 조절 */
                margin-bottom: 40px;
    
            }
    
            /* Pagination 스타일 */
            .pagination {
                list-style: none;
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 20px 0;
            }
    
            .pagination li {
                margin: 0 5px;
            }
    
            .pagination a {
                text-decoration: none;
                padding: 5px 10px;
                border: 1px solid #ccc;
                color: #333;
                background-color: #fff;
                border-radius: 5px;
            }
    
            .pagination a.active {
                background-color: #007bff;
                color: #fff;
            }
    
            /* 링크 기본 스타일 제거 */
            a {
                text-decoration: none;
                /* 밑줄 제거 */
                color: inherit;
                /* 기본 텍스트 색상 상속 */
            }
    
            /* 모든 열 내의 .card 클래스에 스타일 적용 */
            .col .card {
                margin: auto;
                width: 100%;
                height: 350px;
                /* 가로 너비 100%로 설정 */
            }
        </style>
    </head>
<body>
    <header>
        <nav id="navbar-example2" class="navbar bg-body-tertiary px-3 mb-3">
            <a class="navbar-brand" style="margin-left: 20px;" href="/main"><b>Fullstival</b></a>
            <ul class="nav nav-pills">
                <div id="welcome-message" th:if="${session.loggedInUser != null}"
                    th:text="${session.loggedInUser.name} + '님 환영합니다'"
                    style="display: flex; align-items: center; margin-right: 20px;">
                </div>
                <nav class="navbar navbar-expand-lg bg-body-tertiary">
                    <div class="container-fluid">
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                            aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav ">
                                <li class="nav-item" style="margin-right: 30px;">
                                    <a class="nav-link" href="/festival/festivalList">Festival</a>
                                </li>
                                <li class="nav-item" style="margin-right: 30px;">
                                    <a class="nav-link" href="/review/reviewList">Review</a>
                                </li>
                                <li class="nav-item" style="margin-right: 30px;">
                                    <a class="nav-link" href="/notice/notice1">Notice</a>
                                </li>
                                <li class="nav-item" style="margin-right: 30px;">
                                    <a class="nav-link" id="logout">Logout</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </ul>
        </nav>
    </header>

    <div class="container text-center mt-5">
    <form action="/member/modifyPassword" method="post" th:object="${memberDTO}">
        <table class="table table-bordered" style="width: 50%; margin: 0 auto; table-layout: fixed;">
            <tbody>
                <tr>
                    <th scope="row" style="vertical-align: middle; text-align: center;">현재 비밀번호</th>
                    <td style="vertical-align: middle; text-align: center;">
                        <input type="password" name="currentPassword" placeholder="현재 비밀번호 입력하세요" class="form-control"></td>
                </tr>
                <tr>
                    <th scope="row" style="vertical-align: middle; text-align: center;">변경할 비밀번호</th>
                    <td style="vertical-align: middle; text-align: center;">
                        <input type="password" name="newPassword" placeholder="변경할 비밀번호 입력하세요" class="form-control"></td>
                </tr>
                <tr>
                    <th scope="row" style="vertical-align: middle; text-align: center;">변경 비밀번호 확인</th>
                    <td style="vertical-align: middle; text-align: center;">
                        <input type="password" name="confirmPassword" placeholder="변경할 비밀번호 재입력하세요" class="form-control"></td>
                </tr>
            </tbody>
        </table>
        <div th:if="${duplicatePw}" class="alert alert-danger">
            <p th:text="${duplicatePw}"></p>
        </div>

        <div class="mt-3">
            <button type="submit" id="changePassword" class="btn btn-primary">비밀번호 변경</button>
            <button type="button" id="cancel" class="btn btn-primary">취소</button>
        </div>
    </form>
</div>
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gg6vUz1rTL5UHVbNXLKwgpAYNr2NvTAPC5JiKc+2aX8Cxl+U7v2+nSvzvIMnJvWR"
        crossorigin="anonymous"></script>

        <script>
            document.getElementById('cancel').addEventListener('click', function (event) {
                alert("마이페이지로 돌아갑니다.");
                window.location.href = "/member/myPage";
            });
        
            document.getElementById('changePassword').addEventListener('click', function (event) {
                var currentPassword = document.getElementsByName("currentPassword")[0].value;
                var newPassword = document.getElementsByName("newPassword")[0].value;
                var confirmPassword = document.getElementsByName("confirmPassword")[0].value;
        
                // 현재 비밀번호, 새 비밀번호, 확인 비밀번호 모두 입력되었는지 확인
                if (currentPassword === "" || newPassword === "" || confirmPassword === "") {
                    alert("모든 비밀번호 필드를 입력하세요.");
                    event.preventDefault(); // 폼 제출 막음
                    return;
                }
        
                // 새 비밀번호와 확인 비밀번호가 일치하는지 확인
                if (newPassword !== confirmPassword) {
                    alert("새 비밀번호와 확인 비밀번호가 일치하지 않습니다.");
                    event.preventDefault(); // 폼 제출 막음
                    return;
                }
        
                // 새 비밀번호의 패턴 검사 (8~20자의 영어소문자 + 숫자 + 특수문자)
                var passwordPattern = /^(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&()])[A-Za-z\d!@#$%^&()]{8,20}$/;
                if (!passwordPattern.test(newPassword)) {
                    alert("새 비밀번호는 8~20자의 영어 소문자, 숫자, 특수문자(!, @, #, $, %, ^, &, ()) 조합이어야 합니다.");
                    event.preventDefault(); // 폼 제출 막음
                    return;
                }

                alert('비밀번호 변경이 완료 되었습니다. 다시 로그인하세요.');
            });
        </script>
        <script>

            if (document.getElementById('logout')) {
                document.getElementById('logout').addEventListener('click', function (event) {
                    // 사용자가 로그인한 경우
                    console.log('logout 클릭 이벤트 확인용');
                    alert('로그아웃 하겠습니다.');
                    event.preventDefault(); // 기본 동작 방지
                    window.location.href = "/logout"; // 로그아웃으로 이동
                });
            }
        </script>
        


</body>
</html>
